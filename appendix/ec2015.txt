「エンタテインメントコンピューティングシンポジウム (EC2015)」2015 年 9 月

即興的な多人数チームプレイが可能な ブラウザネットワーキングゲーム基盤
高橋 洸人,a) 岩井 将行,b)

概要：近年ネットゲームによるネットワーク負荷が懸念されている．震災時の避難所生活ではネットワー クが確立できないという問題が露呈した．我々はインターネット上のサーバーを必要としない即興的なク ライアント間のリアルタイム通信を実現する，ブラウザネットワーキングを利用したゲーミング基盤の構 築した．その場で自分のスマートフォン端末を用いて多人数で同時にプレイの出来るゲームを実現する．

A Instant Browser Networking Game Platform Supporting Multiple Players
Takahashi Hiroto,a) Iwai Masayuki,b)
Abstract: Network load due to net game is concerned. In the shelter life at the time of the earthquake was exposed is a problem that the network can not be established in recent years. We realize the real-time communication between the improvised clients that do not require a server on the Internet, and the construction of the gaming platform that utilizes the browser networking. To realize the play of the game can be at the same time by many people using their smartphone terminal on the spot.

1. はじめに
複数人でプレイするゲームはハードが複数必要である． 最近ではスマートフォンをプラットフォームとしたゲーム が多くあるが複数人でプレイする場合には参加者全員がア プリをインストールする必要があるなど，手間がかかる場 合が多い．反対に，インストール不要でブラウザで行える オンラインゲームは PC 環境向けがほとんどである．つま り多人数でプレイ可能なゲームは環境を整えるのに時間が かかったり，ハードが人数分必要など制限がかかるなどプ レイの実現に制限がかかってしまうのは問題である．
また現在の Web 分野ではクライアント間でも双方向通 信技術の発展していて，ブラウザを用いた P2P の研究 [1] も行われて有用性も示されている．スマートフォンを分割
†1 現在，東京電機大学 未来科学部 情報メディア学科 Presently with Department of Information Systems and Multimedia Design，School of Science and Technology for Future Life， Tokyo DENKI University
a) hiro@cps.im.dendai.ac.jp b) iwai@ms.im.dendai.ac.jp

表示に用いる研究 [3] や，携帯端末を入力装置としたフレー ムワークの提案 [2] なども行われている．
そこで我々の提案する手法では，近年使用者が多いス マートフォンをコントローラとするプラットフォームで ある．PC やタブレット端末をディスプレイとしてプレイ ヤーが囲ってプレイが出来て，QR コードによる即興的な 環境準備の実現を目指す．
2. 全体概要
ゲームプラットフォームの作成とともに一例として，多 人数対応のブラウザシューティングゲームを作成をした (図￣ 1)．サーバーを起動してモニタとなる端末からブラ ウザでゲームページへアクセスすると (図￣ 2) のように QR コードが表示される．同じ画面で遊ぶプレイヤーはス マートフォン端末で QR コード読み取りをするとコント ローラ用の URL へアクセスすることができプレイに参加 が出来る．
コントローラはスマートフォンを横持ちで，シェイク (ス マートフォンを振る) 動作なども入力としてゲームに入れ

⃝c 2015 Information Processing Society of Japan

1

た (図￣ 3)．socket 通信を用いることでスマホで即時参加 が可能でリアルタイムにプレイヤーの操作が出来る．

シュの 3 つが行える．コントローラ右でショット，コント ローラ左でショット攻撃，シェイクでダッシュが出来る．
プレイヤー数に対する処理速度の考察を行った. 作成し たゲームについて接続人数と FPS を取って回帰分析を行っ た図￣ 6. 7 台の接続時の 28.28fps で若干表示がカクつい ている状態であった

図￣ 1 プレイの様子

図￣ 4 プレイヤー，ショット

図￣ 2 認証 QR コード

図￣ 5 ゲームプレイ画面

図￣ 3 コントローラ，コントローラ説明
3. ゲーム概要
ゲームの内容について説明する． ゲームは平面のシューティングゲームを作成した．ス テージ上をプレイヤー (図￣ 4) が移動できて壁で構成され る部分はオブジェクトが通過できない (図￣ 5)． プレイヤーは HP(Hit Point)，MP(Hit Point) を持って いて，ショット攻撃に MP を消費し，消費した MP はマッ プに散らばり取得すると MP が回復するという特徴のルー ルを加えた． プレイヤーのアクションは移動とショット攻撃とダッ
⃝c 2015 Information Processing Society of Japan

図￣ 6 FPS グラフ

2

4. システム構成
システムの想定環境 大きく分類して 2 のゲーム環境を想定している． ひとつは外部にオープンなサーバーを設置してそこを介
して，ディスプレイとなるクライアントとスマホコント ローラでプレイする環境である (図￣ 8)．プレイヤー同士 が離れていてもオンラインで対戦が出来る環境を作ること が出来る．
もう一つはローカルの PC でサーバーとディスプレイ 両方の役割をするパターンである (図￣ 7)．外部のネット ワークが必要ないというメリットがある．

力を socket を通してメインページを開いているクライアン トへ送信し，プレイヤーのアクションへと同期している．

図￣ 7 ローカル PC をサーバーとした場合

図￣ 9 メインページ接続時の通信

図￣ 8 オンラインサーバーに設置した場合
通信の流れ まずディスプレイとなる端末からメインページ (ドキュ
メントルート/)¡++¿にアクセスする (図￣ 9 - 1，2)．レス ポンス時に socket のコネクションを確立する (図￣ 9 - 3， 4)．
その後，コントローラとして使う端末からチーム選択 ページ (ドキュメントルート/con) にアクセスする (図￣ 10 - 1，2)．チームの選択によりコントローラページ (ドキュメ ントルート/con?team=[num]) に飛び，socket コネクショ ンの確立 (図￣ 10 - 3，4, 5, 6) とともに，ディスプレイ端 末へプレイヤー追加のイベントを送信も行う (図￣ 10 - 7)．
ゲーム時の通信は (図￣ 11) のようにコントローラの入
⃝c 2015 Information Processing Society of Japan

図￣ 10 コントローラ接続時の通信
図￣ 11 ゲーム時のコントロールクエリの同期
3

5. システム詳細
socket.io [4] 複数のプラットフォームでリアルタイムな Web 通信
を実現する．Javascript で記入が可能．通信コストを削減 できるというメリットがあり，ゲームのリアルタイム同期 に使用している．

12/68_12pdf/f01.pdf． [4] Socket.IO: http://socket.io/．
[5] enchant.js - A simple JavaScript framework for creating games and apps.: http://enchantjs.com/ja/．

Node.js Socket 通信に向いているためバックエンドのフレーム
ワークとして使用した．Web サーバの運用と，クライアン トとのソケット通信を行う．

enchant.js [5] Javascript のゲームフレームワークであり，マルチ
プラットフォームで iPhone，Android，WindowsPhone な どでも動作するアプリを開発することが出来る．メインの ゲーム画面，コントローラの処理両方に用いた．
6. おわりに
今回作ったゲームは 4 人で接続で 20 秒に一度ほどゲー ムのフリーズが発生，8 人での接続だと常時カクつきが見 られた．ソケットで扱うデータが単純であれば性能の向上 ができると考えられる．
即興性の面での評価は，実際に使ってプレイまでの準備 がスムーズに行えた．ローカルネットワーク内の場合はア クセスポイントの選択が必要になる場合もあるが大した手 間では無いと考えられる．
このシステムの応用としては，サーバーサイドの汎用化， ライブラリ化が望める．RaspberryPI への移植も行えれば Wiﬁ を吹くことでネットワーク環境のない被災地などでも モバイル端末への通信の可能性も広がると思われる．
謝辞 本研究は H27 科研費若手研究 (A)(代表者:岩井将 行，課題番号:25700007) の一部により行われている．
SIP（戦略的イノベーション創造プログラム）課題「レジ リエントな防災・減災機能の強化」巨大都市・大規模ター ミナル駅周辺地域における複合災害への対応支援アプリ ケーションの開発の一部として行っている．

参考文献
[1] 小久江 卓哉，中村 貴洋，宮下 芳明: WebSocket を用い た Web ブラウザ間 P2P 通信の実現とその応用に関する 研究．http://ci.nii.ac.jp/naid/110008675481.
[2] 中村智之，金子晃介，岡田義広: 携帯端末をデータ放 送コンテンツの直観的な入力装置として利用可能とす るフレームワークの提案．http://ci.nii.ac.jp/naid/ 110009784022．
[3] 坂 井 成 道, 峰 松 美 佳, 会 津 宏 幸: HTML5 構 成 変 換 技 術 を 用 い た 複 数 端 末 へ の Web ペ ー ジ 分 割 表 示 シ ス テ ム http://www.toshiba.co.jp/tech/review/2013/

⃝c 2015 Information Processing Society of Japan

4

